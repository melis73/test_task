apiVersion: autoscaling/v1
kind: HorizontalPodAutoscaler
metadata:
  name: bestapp-hpa
spec:
  maxReplicas: 4
  minReplicas: 2
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: bestapp-deployment
  targetCPUUtilizationPercentage: 40%       #При превышении загрузки cpu подов выше 40 процентов запускать еще один. Сделал такой предел из следующих соображений:
                                            #потребление cpu в одном контейнере в штатном режиме в условиях озвучено 0.1 (100m). Я для покрытия повышенного
                                            #потребления при запуске приложения выставил лимит 300m. От них будет считаться текущая загрузка процессора. Мне нужно,
                                            #чтобы выше 100m автоматически выполнялся скейлинг и запускался еще один под. Выставил 40% - следующий под должен
                                            #создаваться при 300m * 0.4 = 120m cpu.
                                            #То, что лимит триггера установлен низко, и вроде бы мы слишком расточительно расходуем недонагруженные поды при 
                                            #условии использовать минимальные ресурсы - противоречие кажущееся. Нам нужно экономить не поды, а именно суммарные 
                                            #ресурсы cpu в них.
